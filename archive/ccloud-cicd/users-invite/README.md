# Confluent Cloud Invite Users Automation and RBAC Authorization
This set of scripts automates the process of inviting users to Confluent Cloud and configuring RBAC (Role-Based Access Control) authorization for the invited users. The automation consists of two scripts: `invite-users-v2.py` and `convert-to-yaml.py`.

## Prerequisites
Before running the scripts, ensure that you have the following prerequisites:

Python 3 installed on your system
The required Python packages installed (can be installed via `pip`):
```
http.client
json
base64
logging
requests
yaml
```
## Configuration
### invite-users-v2.py
The `invite-users-v2.py` script requires a configuration file named `config.json` to be present in the same directory. The configuration file should have the following structure:
```
{
  "API_KEY": "your-api-key",
  "API_SECRET": "your-api-secret"
}

```

Replace the values with your actual Confluent Cloud API key and API secret.

The script also requires an input file named users-email.txt that contains a list of email addresses, with each address on a separate line.

### convert-to-yaml.py
The convert-to-yaml.py script expects the user-accounts.json file generated by the invite-users-v2.py script to be present in the same directory. The JSON file should contain the user data in the following format:

```
{
    "user_id_1": {
        "email": "user1@example.com",
        "role_definitions": [
            {
                "role_name": "DeveloperRead",
                "crn_pattern": "crn://confluent.cloud/organization=your-org-id/environment=your-env-id/cloud-cluster=your-cluster-id/kafka=your-cluster-id/topic=*"
            },
            {
                "role_name": "DataDiscovery",
                "crn_pattern": "crn://confluent.cloud/organization=your-org-id/environment=your-env-id"
            }
        ]
    },
    "user_id_2": {
        "email": "user2@example.com",
        "role_definitions": [
            {
                "role_name": "DeveloperWrite",
                "crn_pattern": "crn://confluent.cloud/organization=your-org-id/environment=your-env-id/cloud-cluster=your-cluster-id/kafka=your-cluster-id/topic=*"
            },
            {
                "role_name": "DataDiscovery",
                "crn_pattern": "crn://confluent.cloud/organization=your-org-id/environment=your-env-id"
            }
        ]
    },
    ...
}

```

Replace the placeholders (`your-org-id`, `your-env-id`, `your-cluster-id`, etc.) with your actual values. Add as many user entries as required.

## Running the Scripts
1. Ensure that the configuration files (`config.json` and `users-email.txt`) are properly configured.

2. Open a terminal or command prompt and navigate to the directory containing the scripts.

3. Run the following command to execute the `invite-users-v2.py` script:
```
python invite-users-v2.py
```
The script will send invitations to the users specified in the users-email.txt file, and it will generate the `user-accounts.json` file containing the user data.

4. Run the following command to execute the `convert-to-yaml.py` script:
```
python convert-to-yaml.py

```
The script will convert the user-accounts.json file to a YAML file named output.tfvars in the tfvars format.

5. The resulting `output.tfvars` file can be used by the Terraform script in the `rbac-users` folder to grant RBAC roles to the invited users in Confluent Cloud.

> Please exercise caution when using these scripts, as they interact with your Confluent Cloud account and perform actions such as inviting users and configuring RBAC. Make sure to review the configurations and understand the implications before running the scripts.


## Troubleshooting
- If the scripts fail to connect to Confluent Cloud or encounter authentication errors, ensure that the provided API key and API secret in the `config.json` file are correct.
- If the scripts fail to send invitations, check the logs in the `invite.log` file for more details. The logs should provide information about any errors encountered during the invitation process.
- If the `convert-to-yaml.py` script fails due to missing or invalid input files, ensure that the `user-accounts.json` file generated by the `invite-users-v2.py` script is present in the same directory.
